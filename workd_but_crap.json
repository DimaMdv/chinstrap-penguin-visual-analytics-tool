{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {
    "url": "processed_data/meta_pca.csv"
  },
  "params": [
    {
      "name": "max_distance",
      "value": 1200,
      "bind": {
        "input": "range",
        "min": 0,
        "max": 1200,
        "step": 100,
        "name": "Max distance (km): "
      }
    }
  ],
  "vconcat": [
    {
      "params": [
        {
          "name": "pts",
          "select": {"type": "interval", "encodings": ["x", "y"]}
        }
      ],
      "mark": "point",
      "width": 600,
      "height": 300,
      "transform": [
        {"filter": "datum.PCA0 < -304"}
      ],
      "encoding": {
        "x": {
          "field": "PCA0",
          "type": "quantitative",
          "title": "PCA Component 0",
          "scale": {"domain": [-308, -303]}
        },
        "y": {
          "field": "PCA1",
          "type": "quantitative",
          "title": "PCA Component 1",
          "scale": {"domain": [35, 39]}
        },
        "color": {
          "field": "season_success",
          "type": "nominal",
          "title": "Season Success"
        },
        "opacity": {
          "condition": [
            {"param": "pts", "value": 0.8},
            {"param": "weight_selection", "value": 0.8},
            {"param": "bill_selection", "value": 0.8}
          ],
          "value": 0.1
        },
        "tooltip": [
          {"field": "path_len", "type": "quantitative", "title": "Distance (km)", "format": ".2f"},
          {"field": "Weight_deployment", "type": "quantitative", "title": "Weight deployment (kg)", "format": ".2f"},
          {"field": "Bill_length", "type": "quantitative", "title": "Bill length (mm)", "format": ".2f"}
        ]
      },
      "title": "Embedding"
    },
    {
      "hconcat": [
        {
          "width": 300,
          "height": 300,
          "title": "Average distance traveled compared to weight",
          "layer": [
            {
              "params": [
                {
                  "name": "weight_selection",
                  "select": {"type": "interval"}
                }
              ],
              "mark": {"type": "point", "size": 0.1, "opacity": 0},
              "transform": [
                {"filter": {"param": "pts"}}
              ],
              "encoding": {
                "x": {"field": "Weight_deployment", "type": "quantitative", "scale": {"domain": [0, 5.5]}},
                "y": {"field": "Weight_return", "type": "quantitative", "scale": {"domain": [0, 5.5]}}
              }
            },
            {
              "mark": "rect",
              "transform": [
                {"filter": {"param": "pts"}},
                {"bin": {"minstep": 0.1, "maxbins": 50}, "field": "Weight_deployment", "as": "Weight_deployment_bin"},
                {"bin": {"minstep": 0.1, "maxbins": 50}, "field": "Weight_return", "as": "Weight_return_bin"},
                {
                  "aggregate": [{"op": "mean", "field": "path_len", "as": "mean_path_len"}],
                  "groupby": ["Weight_deployment_bin", "Weight_deployment_bin_end", "Weight_return_bin", "Weight_return_bin_end"]
                },
                {"filter": "datum.mean_path_len <= max_distance"}
              ],
              "encoding": {
                "x": {"field": "Weight_deployment_bin", "type": "quantitative", "title": "Weight on deployment (kg)"},
                "x2": {"field": "Weight_deployment_bin_end"},
                "y": {"field": "Weight_return_bin", "type": "quantitative", "title": "Weight on return (kg)"},
                "y2": {"field": "Weight_return_bin_end"},
                "color": {"field": "mean_path_len", "type": "quantitative", "title": "Average distance traveled (km)"},
                "tooltip": [{"field": "mean_path_len", "type": "quantitative", "title": "Avg. distance (km)", "format": ".2f"}]
              }
            }
          ]
        },
        {
          "width": 300,
          "height": 300,
          "title": "Average distance traveled compared to bill size",
          "layer": [
            {
              "params": [
                {
                  "name": "bill_selection",
                  "select": {"type": "interval"}
                }
              ],
              "mark": {"type": "point", "size": 0.1, "opacity": 0},
              "transform": [
                {"filter": {"param": "pts"}}
              ],
              "encoding": {
                "x": {"field": "Bill_length", "type": "quantitative", "scale": {"domain": [40, 60]}},
                "y": {"field": "Bill_depth", "type": "quantitative", "scale": {"domain": [10, 22]}}
              }
            },
            {
              "mark": "rect",
              "transform": [
                {"filter": {"param": "pts"}},
                {"bin": {"minstep": 0.5, "maxbins": 50}, "field": "Bill_length", "as": "Bill_length_bin"},
                {"bin": {"minstep": 0.25, "maxbins": 50}, "field": "Bill_depth", "as": "Bill_depth_bin"},
                {
                  "aggregate": [{"op": "mean", "field": "path_len", "as": "mean_path_len"}],
                  "groupby": ["Bill_length_bin", "Bill_length_bin_end", "Bill_depth_bin", "Bill_depth_bin_end"]
                },
                {"filter": "datum.mean_path_len <= max_distance"}
              ],
              "encoding": {
                "x": {"field": "Bill_length_bin", "type": "quantitative", "title": "Bill length (mm)"},
                "x2": {"field": "Bill_length_bin_end"},
                "y": {"field": "Bill_depth_bin", "type": "quantitative", "title": "Bill depth (mm)"},
                "y2": {"field": "Bill_depth_bin_end"},
                "color": {"field": "mean_path_len", "type": "quantitative", "title": "Average distance traveled (km)"},
                "tooltip": [{"field": "mean_path_len", "type": "quantitative", "title": "Avg. distance (km)", "format": ".2f"}]
              }
            }
          ]
        },
        {
          "mark": {"type": "boxplot", "extent": "min-max"},
          "width": 300,
          "height": 300,
          "title": "Distance Traveled (km) by Season Success",
          "transform": [
            {"filter": {"param": "pts"}}
          ],
          "encoding": {
            "x": {
              "field": "season_success",
              "type": "nominal",
              "title": "Season Success"
            },
            "y": {
              "field": "path_len",
              "type": "quantitative",
              "title": "Distance Traveled (km)",
              "scale": {"domain": [0, 1200]}
            },
            "color": {
              "field": "season_success",
              "type": "nominal",
              "title": "Season Success"
            }
          }
        }
      ]
    }
  ]
}